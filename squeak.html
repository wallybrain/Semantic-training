<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQUEAK :: Smalltalk Environment</title>
    <meta name="description" content="Private Squeak 6.0 Smalltalk environment running in the browser via SqueakJS.">
    <meta property="og:title" content="SQUEAK â€” Smalltalk Environment">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://wallyblanchard.com/squeak.html">
    <link rel="canonical" href="https://wallyblanchard.com/squeak.html">
    <style>
        @font-face {
            font-family: 'VT323';
            font-style: normal;
            font-weight: 400;
            font-display: swap;
            src: url(fonts/VT323-Regular.woff2) format('woff2');
        }
        @font-face {
            font-family: 'Courier Prime';
            font-style: normal;
            font-weight: 400;
            font-display: swap;
            src: url(fonts/CourierPrime-Regular.woff2) format('woff2');
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg: #0e0a1e;
            --module-bg: #06060f;
            --primary: #66d9a0;
            --primary-dim: #4daa7a;
            --primary-dark: #337755;
            --accent: #00ccff;
            --text: #66d9a0;
            --mono: 'VT323', monospace;
            --mono-alt: 'Courier Prime', monospace;
            --bar-height: 38px;
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: var(--mono);
            overflow: hidden;
            height: 100vh;
        }

        #top-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--bar-height);
            background: var(--module-bg);
            border-bottom: 1px solid var(--primary-dark);
            display: flex;
            align-items: center;
            padding: 0 12px;
            gap: 16px;
            z-index: 100;
            font-size: 15px;
            letter-spacing: 1px;
        }

        #top-bar .title {
            font-size: 20px;
            color: var(--primary);
            text-shadow: 0 0 8px var(--primary-dark), 0 0 20px rgba(0, 255, 65, 0.15);
            letter-spacing: 3px;
            flex-shrink: 0;
        }

        #top-bar .separator {
            flex-grow: 1;
        }

        .bar-btn {
            background: transparent;
            border: 1px solid var(--primary-dark);
            color: var(--primary-dim);
            font-family: var(--mono);
            font-size: 14px;
            padding: 2px 10px;
            cursor: pointer;
            letter-spacing: 1px;
            white-space: nowrap;
        }

        .bar-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
            text-shadow: 0 0 5px var(--primary);
        }

        .bar-link {
            color: var(--primary-dim);
            text-decoration: none;
            font-size: 14px;
            border: 1px solid var(--primary-dark);
            padding: 2px 10px;
            white-space: nowrap;
        }

        .bar-link:hover {
            color: var(--primary);
            border-color: var(--primary);
            text-shadow: 0 0 5px var(--primary);
        }

        #sqCanvas {
            position: fixed;
            top: var(--bar-height);
            left: 0;
            width: 100vw;
            height: calc(100vh - var(--bar-height) - var(--bar-height));
            background: #000;
            cursor: default;
            user-select: none;
            -webkit-user-select: none;
        }

        #bottom-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: var(--bar-height);
            background: var(--module-bg);
            border-top: 1px solid var(--primary-dark);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 12px;
            z-index: 100;
            font-size: 13px;
            color: var(--primary-dark);
            letter-spacing: 1px;
        }

        #bottom-bar span {
            white-space: nowrap;
        }

        #bottom-bar .active {
            color: var(--primary);
        }

        /* Loading overlay */
        #loading-overlay {
            position: fixed;
            top: var(--bar-height);
            left: 0;
            right: 0;
            bottom: var(--bar-height);
            background: var(--bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 50;
            gap: 16px;
            transition: opacity 0.5s ease;
        }

        #loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-text {
            color: var(--primary);
            font-size: 24px;
            letter-spacing: 4px;
        }

        .loading-detail {
            color: var(--primary-dark);
            font-size: 16px;
            letter-spacing: 2px;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 1; }
        }

        .loading-dots {
            display: flex;
            gap: 8px;
        }

        .loading-dots span {
            width: 8px;
            height: 8px;
            background: var(--primary);
            border-radius: 50%;
            animation: pulse 1.4s ease-in-out infinite;
        }

        .loading-dots span:nth-child(2) { animation-delay: 0.2s; }
        .loading-dots span:nth-child(3) { animation-delay: 0.4s; }

        /* SqueakJS spinner (hidden, but required by SqueakJS) */
        #sqSpinner {
            display: none;
        }

        /* Fullscreen mode */
        :fullscreen #top-bar,
        :fullscreen #bottom-bar {
            display: none;
        }

        :fullscreen #sqCanvas {
            top: 0;
            height: 100vh;
        }
    </style>
</head>
<body>
    <div id="top-bar">
        <span class="title">SQUEAK</span>
        <button class="bar-btn" onclick="toggleFullscreen()">FULLSCREEN</button>
        <button class="bar-btn" id="btn-download" onclick="downloadImage()">DOWNLOAD IMAGE</button>
        <span class="separator"></span>
        <a href="/" class="bar-link">[home]</a>
        <a href="https://wallybrain.net" class="bar-link">[wallybrain]</a>
        <a href="fnord.html" class="bar-link">[fnord]</a>
        <a href="library.html" class="bar-link">[antilibrary]</a>
        <a href="synth.html" class="bar-link">[synth]</a>
        <a href="https://solitaire.wallybrain.icu" class="bar-link">[solitaire]</a>
        <a href="zork.html" class="bar-link">[zork]</a>
        <a href="https://code.wallyblanchard.com" class="bar-link">[IDE]</a>
    </div>

    <canvas id="sqCanvas"></canvas>
    <div id="sqSpinner"><div></div></div>

    <div id="loading-overlay">
        <div class="loading-text">LOADING SQUEAK 6.0</div>
        <div class="loading-dots"><span></span><span></span><span></span></div>
        <div class="loading-detail">First load may take 30-60 seconds (cached after)</div>
    </div>

    <div id="bottom-bar">
        <span>SQUEAK 6.0 (64-BIT)</span>
        <span id="vm-status">VM: LOADING</span>
        <span>ENGINE: SqueakJS</span>
        <span id="clock-display"></span>
    </div>

    <script src="squeak/vm/squeak_bundle.js"></script>
    <script>
        function updateClock() {
            var d = new Date();
            document.getElementById('clock-display').textContent =
                'UTC ' + d.toISOString().slice(11, 19);
        }
        setInterval(updateClock, 1000);
        updateClock();

        window.onload = function() {
            var canvas = document.getElementById('sqCanvas');
            var overlay = document.getElementById('loading-overlay');
            var vmStatus = document.getElementById('vm-status');

            function resizeCanvas() {
                if (canvas.width !== canvas.offsetWidth ||
                    canvas.height !== canvas.offsetHeight) {
                    canvas.width = canvas.offsetWidth;
                    canvas.height = canvas.offsetHeight;
                }
            }
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);

            SqueakJS.runSqueak('squeak/Squeak6.0.zip', canvas, {
                appName: 'Squeak 6.0',
                embedded: true,
                wizard: false,
                spinner: document.getElementById('sqSpinner'),
                onStart: function() {
                    overlay.classList.add('hidden');
                    vmStatus.textContent = 'VM: RUNNING';
                    vmStatus.classList.add('active');
                },
                onQuit: function() {
                    vmStatus.textContent = 'VM: STOPPED';
                    vmStatus.classList.remove('active');
                }
            });
        };

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        function downloadImage() {
            if (typeof SqueakJS !== 'undefined' && SqueakJS.vm) {
                SqueakJS.vm.saveImageAs && SqueakJS.vm.saveImageAs();
            }
        }
    </script>
</body>
</html>
